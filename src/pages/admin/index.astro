---
import Layout from "@/layouts/Layout.astro";
import { lucia } from "@/lib/auth";

// Check authentication
try {
  const sessionId = Astro.cookies.get("auth_session")?.value;
  if (!sessionId) {
    return Astro.redirect("/admin/login");
  }

  const session = await lucia.getSession(sessionId);
  if (!session) {
    Astro.cookies.delete("auth_session");
    return Astro.redirect("/admin/login");
  }
  // If authenticated, redirect to the results page
  return Astro.redirect("/admin/results");
} catch (e) {
  console.error("Auth error:", e);
  Astro.cookies.delete("auth_session");
  return Astro.redirect("/admin/login");
}

// User is authenticated, proceed with rendering
---

<Layout title="Admin Dashboard" isLandingPage={false}>
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-white">Admin Dashboard</h1>
        <form action="/api/auth/logout" method="POST">
          <button type="submit" class="px-4 py-2 text-sm text-white bg-gray-700 rounded hover:bg-gray-600">
            Logout
          </button>
        </form>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        <!-- Survey Results Card -->
        <a href="/admin/results" 
           class="block p-6 bg-gray-800 border border-gray-700 rounded-lg hover:bg-gray-700 transition-colors">
          <h2 class="mb-2 text-xl font-bold text-white">Survey Results</h2>
          <p class="text-gray-400">View and analyze survey responses and demographic data.</p>
        </a>

        <!-- Future Admin Features -->
        <div class="p-6 bg-gray-800/50 border border-gray-700 rounded-lg">
          <h2 class="mb-2 text-xl font-bold text-gray-400">Analytics Dashboard</h2>
          <p class="text-gray-500">Coming soon - Visualize survey trends and insights.</p>
        </div>

        <div class="p-6 bg-gray-800/50 border border-gray-700 rounded-lg">
          <h2 class="mb-2 text-xl font-bold text-gray-400">User Management</h2>
          <p class="text-gray-500">Coming soon - Manage admin access and permissions.</p>
        </div>
      </div>
    </div>
  </div>
</Layout>
