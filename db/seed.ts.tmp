import { db, SurveyUser } from "astro:db";
import { eq } from "astro:db";
import bcrypt from "bcryptjs";

export default async function seed() {
  // Check if admin user already exists
  const existingAdmin = await db.select().from(SurveyUser)
    .where(eq(SurveyUser.username, "admin"))
    .get();
  
  if (!existingAdmin) {
    // Create a hashed password for the admin user
    const hashedPassword = await bcrypt.hash("admin", 10);

    await db.insert(SurveyUser).values([
      {
        id: "admin-user",
        username: "admin",
        password: hashedPassword,
      },
    ]);
    console.log("Created admin user");
  }
}
